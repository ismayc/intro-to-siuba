(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{833:function(t,e,d){"use strict";e.a={name:"VueRemarkRoot",render:function(t){return t("div",null,this.$slots.default)}}},834:function(t,e,d){"use strict";t.exports=function(t,e){return e||(e={}),"string"!=typeof(t=t&&t.__esModule?t.default:t)?t:(e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t)}},973:function(t,e,d){t.exports=d.p+"assets/img/model-mutate.cad47ff0.png"},991:function(t,e,d){"use strict";d.r(e);var a=d(9),o=d(834),n=d.n(o),r=d(973),s=d.n(r),i="<section none><section none> <h1 id=the-mutate-verb>The mutate verb</h1> <p><img src="+n()(s.a)+' alt=""></p> <aside class=notes> <p>You&#39;ve already learned two verbs for manipulating data: filter for extracting a subset of the observations, and arrange for sorting them. Suppose you want to change one of the variables in your dataset, based on the other ones. Or suppose you want to add a new variable. For that, you would use the mutate verb.</p> </aside></section></section><section none><section none> <h2 id=using-mutate-to-change-a-variable>Using mutate to change a variable</h2> <pre><code class=language-python>(music_top200\n  &gt;&gt; mutate(streams = _.streams / 1000)\n)</code></pre> <div> <style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe thead th{text-align:right}</style><p></p> <table border=1 class=dataframe> <thead> <tr style=text-align:right> <th></th> <th>country</th> <th>position</th> <th>track_name</th> <th>artist</th> <th>streams</th> <th>duration</th> <th>continent</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Argentina</td> <td>1</td> <td>Tusa</td> <td>KAROL G</td> <td>1858.666</td> <td>200.960</td> <td>Americas</td> </tr> <tr> <th>1</th> <td>Argentina</td> <td>2</td> <td>Tattoo</td> <td>Rauw Alejandro</td> <td>1344.382</td> <td>202.887</td> <td>Americas</td> </tr> <tr> <th>2</th> <td>Argentina</td> <td>3</td> <td>Hola - Remix</td> <td>Dalex</td> <td>1330.011</td> <td>249.520</td> <td>Americas</td> </tr> <tr> <th>...</th> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> </tr> <tr> <th>12397</th> <td>South Africa</td> <td>198</td> <td>Black And White</td> <td>Niall Horan</td> <td>11.771</td> <td>193.090</td> <td>Africa</td> </tr> <tr> <th>12398</th> <td>South Africa</td> <td>199</td> <td>When I See U</td> <td>Fantasia</td> <td>11.752</td> <td>217.347</td> <td>Africa</td> </tr> <tr> <th>12399</th> <td>South Africa</td> <td>200</td> <td>Psycho!</td> <td>MASN</td> <td>11.743</td> <td>197.217</td> <td>Africa</td> </tr> </tbody> </table> <p>12400 rows × 7 columns</p> </div> <aside class=notes> <p>First you&#39;ll learn how to change an existing variable.</p> <p>You use mutate like you would filter or arrange, after a pipe operator.</p> <p>Inside this mutate statement, what&#39;s on the right of the equals sign is what&#39;s being calculated, and what&#39;s on the left is what&#39;s being replaced. Here, you&#39;re calculating pop slash one million.</p> <p>The slash in Python performs division, so &quot;population divided by one million&quot;.</p> <p>On the left, you&#39;re saying you want to replace the existing pop column, by writing pop equals.</p> <p>The result is the same table, but with pop replaced with a new value, one that&#39;s much smaller than it was before. This is how you manipulate existing variables in the table. That&#39;s often necessary during data processing and cleaning. Just like filter and arrange, you&#39;re not altering the original gapminder data, you&#39;re just changing the value in this new data frame that&#39;s being returned.</p> </aside></section></section><section none><section none> <h2 id=using-mutate-to-add-a-new-variable>Using mutate to add a new variable</h2> <pre><code class=language-python>(music_top200\n  &gt;&gt; mutate(ttl_stream_time = _.streams * _.duration)\n)</code></pre> <div> <style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe thead th{text-align:right}</style><p></p> <table border=1 class=dataframe> <thead> <tr style=text-align:right> <th></th> <th>country</th> <th>position</th> <th>track_name</th> <th>artist</th> <th>streams</th> <th>duration</th> <th>continent</th> <th>ttl_stream_time</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Argentina</td> <td>1</td> <td>Tusa</td> <td>KAROL G</td> <td>1858666</td> <td>200.960</td> <td>Americas</td> <td>3.735175e+08</td> </tr> <tr> <th>1</th> <td>Argentina</td> <td>2</td> <td>Tattoo</td> <td>Rauw Alejandro</td> <td>1344382</td> <td>202.887</td> <td>Americas</td> <td>2.727576e+08</td> </tr> <tr> <th>2</th> <td>Argentina</td> <td>3</td> <td>Hola - Remix</td> <td>Dalex</td> <td>1330011</td> <td>249.520</td> <td>Americas</td> <td>3.318643e+08</td> </tr> <tr> <th>...</th> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> </tr> <tr> <th>12397</th> <td>South Africa</td> <td>198</td> <td>Black And White</td> <td>Niall Horan</td> <td>11771</td> <td>193.090</td> <td>Africa</td> <td>2.272862e+06</td> </tr> <tr> <th>12398</th> <td>South Africa</td> <td>199</td> <td>When I See U</td> <td>Fantasia</td> <td>11752</td> <td>217.347</td> <td>Africa</td> <td>2.554262e+06</td> </tr> <tr> <th>12399</th> <td>South Africa</td> <td>200</td> <td>Psycho!</td> <td>MASN</td> <td>11743</td> <td>197.217</td> <td>Africa</td> <td>2.315919e+06</td> </tr> </tbody> </table> <p>12400 rows × 8 columns</p> </div> <aside class=notes> <p>Alternatively, you may want to add a new variable.</p> <p>For instance, suppose you want to know the total seconds people have listened to a track. In the data you have a tracks duration in seconds, and its number of streams. This means <strong>total time listened is duration multiplied by streams</strong>.</p> <p>You would use mutate in almost the same way. You pipe your music data to the mutate verb. The asterisk in Python represents multiplication, so you write streams asterisk duration to multiply the two columns.</p> <p>Notice that to be informative, we have named the column gdp, that&#39;s what&#39;s to the left of the equals sign in our code. Column names need to be one word like this: you can&#39;t use spaces.</p> <p>Notice that in the results, there&#39;s a brand new gdp column, which is much larger than the gdp per capita.</p> </aside></section></section><section none><section none> <h2 id=answering-a-question>Answering a question</h2> <pre><code class=language-python>(music_top200\n  &gt;&gt; mutate(ttl_stream_time = _.streams * _.duration)\n  &gt;&gt; filter(_.country == &quot;Costa Rica&quot;)\n  &gt;&gt; arrange(-_.ttl_stream_time)\n)</code></pre> <div> <style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe thead th{text-align:right}</style><p></p> <table border=1 class=dataframe> <thead> <tr style=text-align:right> <th></th> <th>country</th> <th>position</th> <th>track_name</th> <th>artist</th> <th>streams</th> <th>duration</th> <th>continent</th> <th>ttl_stream_time</th> </tr> </thead> <tbody> <tr> <th>2200</th> <td>Costa Rica</td> <td>1</td> <td>Safaera</td> <td>Bad Bunny</td> <td>338078</td> <td>295.177</td> <td>Americas</td> <td>9.979285e+07</td> </tr> <tr> <th>2202</th> <td>Costa Rica</td> <td>3</td> <td>Ignorantes</td> <td>Bad Bunny</td> <td>233113</td> <td>210.607</td> <td>Americas</td> <td>4.909523e+07</td> </tr> <tr> <th>2222</th> <td>Costa Rica</td> <td>23</td> <td>René</td> <td>Residente</td> <td>101872</td> <td>457.592</td> <td>Americas</td> <td>4.661581e+07</td> </tr> <tr> <th>...</th> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> </tr> <tr> <th>2377</th> <td>Costa Rica</td> <td>178</td> <td>Dónde Estás</td> <td>KHEA</td> <td>23177</td> <td>153.560</td> <td>Americas</td> <td>3.559060e+06</td> </tr> <tr> <th>2394</th> <td>Costa Rica</td> <td>195</td> <td>Blueberry Faygo</td> <td>Lil Mosey</td> <td>21771</td> <td>162.547</td> <td>Americas</td> <td>3.538811e+06</td> </tr> <tr> <th>2397</th> <td>Costa Rica</td> <td>198</td> <td>Ride It</td> <td>Regard</td> <td>21731</td> <td>157.606</td> <td>Americas</td> <td>3.424936e+06</td> </tr> </tbody> </table> <p>200 rows × 8 columns</p> </div> <aside class=notes> <p>Let&#39;s put together the three verbs you learned in this chapter to answer a question about our data.</p> <p>Suppose we wanted to know for a country, like Costa Rica, what songs where listened to longest.</p> <p>We would do this in three steps: </p> <ul> <li>create the column</li> <li>filter for country</li> <li>then sort</li> </ul> <p>We use mutate to create the <code>ttl_stream_time</code> column. Then we&#39;d use filter to restrict our analysis to only Costa Rica. Then we&#39;d use arrange to sort the data in descending order of our new ttl_stream_time variable.</p> <p>This gives us the answer we&#39;re looking for. The most streamed track in Costa Rica is still the first in our result. However, it looks like the track normally in the 23rd position--René by Residente--is third, since it&#39;s over 7 minutes long!</p> </aside></section></section>',h=d(833),l=d(7);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}l.a.config.optionMergeStrategies;var c={slides:i,VueRemarkRoot:h.a},p=function(t){var e=t.options.components=t.options.components||{},d=t.options.computed=t.options.computed||{};Object.keys(c).forEach((function(t){"object"===u(c[t])&&"function"==typeof c[t].render?e[t]=c[t]:d[t]=function(){return c[t]}}))},m=l.a.config.optionMergeStrategies,_="__vueRemarkFrontMatter",g={excerpt:null,title:"Mutate",output:"html_document",editor_options:{chunk_output_type:"console"},chunk:"basics"};var f=function(t){t.options[_]&&(t.options[_]=g),l.a.util.defineReactive(t.options,_,g),t.options.computed=m.computed({$frontmatter:function(){return t.options[_]}},t.options.computed)},v=Object(a.a)({},(function(){var t=this,e=t.$createElement,d=t._self._c||e;return d("VueRemarkRoot",[d("Notebook",{attrs:{branch:"master",repo:"machow/purview",url:"https://mybinder.org",useBinder:"1"},scopedSlots:t._u([{key:"default",fn:function(e){return[d("details",{directives:[{name:"fix-codemirror",rawName:"v-fix-codemirror"}]},[d("code-cell",{attrs:{status:e.status,onExecute:e.execute,onReady:e.updateSetupCode,language:"python"}},[d("pre",{pre:!0,attrs:{class:"language-text"}},[d("code",{pre:!0,attrs:{class:"language-text"}},[t._v('# TODO: explain how to run this, and that they only need the gist (loads tools)\nimport pandas as pd\nfrom siuba import arrange, select, mutate, filter, _\nfrom plotnine import ggplot, geom_point, coord_flip, aes, labs\n\n# temporary until I figure out where to put data\nfname = "https://siublocks.s3.us-east-2.amazonaws.com/course-data/music200.csv"\nmusic_top200 = pd.read_csv(fname)\n\n# tracks\nfname = "https://siublocks.s3.us-east-2.amazonaws.com/course-data/track_features.csv"\ntrack_features = pd.read_csv(fname)\n\n\n# TODO: shift into a package or file\nfrom siuba import pipe\nfrom IPython.display import HTML, display\n___ = pipe(lambda x: display(HTML("⚠️: <b>Don\'t forget to replace all the blanks!<b>")) and _)\n\npd.set_option("display.max_rows", 6)\n\nfrom IPython import get_ipython\n# special ipython function to get the html formatter\nhtml_formatter = get_ipython().display_formatter.formatters[\'text/html\']\n\n# when you see a Shout object, call the shout_html function on it\nhtml_formatter.for_type(pd.DataFrame, lambda df: df.to_html(max_rows = pd.get_option("display.max_rows")))')])])])],1),d("RevealSlides",{attrs:{slides:t.slides}}),d("code-cell",{attrs:{status:e.status,onExecute:e.execute,language:"python"},scopedSlots:t._u([{key:"output",fn:function(){return[d("table",{staticClass:"dataframe",attrs:{border:"1"}},[d("thead",[d("tr",{staticStyle:{"text-align":"right"}},[d("th"),d("th",[t._v("country")]),d("th",[t._v("position")]),d("th",[t._v("track_name")]),d("th",[t._v("artist")]),d("th",[t._v("streams")]),d("th",[t._v("duration")]),d("th",[t._v("continent")]),d("th",[t._v("streamed_ms")])])]),d("tbody",[d("tr",[d("th",[t._v("0")]),d("td",[t._v("Argentina")]),d("td",[t._v("1")]),d("td",[t._v("Tusa")]),d("td",[t._v("KAROL G")]),d("td",[t._v("1858666")]),d("td",[t._v("200.960")]),d("td",[t._v("Americas")]),d("td",[t._v("3.735175e+08")])]),d("tr",[d("th",[t._v("1")]),d("td",[t._v("Argentina")]),d("td",[t._v("2")]),d("td",[t._v("Tattoo")]),d("td",[t._v("Rauw Alejandro")]),d("td",[t._v("1344382")]),d("td",[t._v("202.887")]),d("td",[t._v("Americas")]),d("td",[t._v("2.727576e+08")])]),d("tr",[d("th",[t._v("2")]),d("td",[t._v("Argentina")]),d("td",[t._v("3")]),d("td",[t._v("Hola - Remix")]),d("td",[t._v("Dalex")]),d("td",[t._v("1330011")]),d("td",[t._v("249.520")]),d("td",[t._v("Americas")]),d("td",[t._v("3.318643e+08")])]),d("tr",[d("th",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")]),d("td",[t._v("...")])]),d("tr",[d("th",[t._v("12397")]),d("td",[t._v("South Africa")]),d("td",[t._v("198")]),d("td",[t._v("Black And White")]),d("td",[t._v("Niall Horan")]),d("td",[t._v("11771")]),d("td",[t._v("193.090")]),d("td",[t._v("Africa")]),d("td",[t._v("2.272862e+06")])]),d("tr",[d("th",[t._v("12398")]),d("td",[t._v("South Africa")]),d("td",[t._v("199")]),d("td",[t._v("When I See U")]),d("td",[t._v("Fantasia")]),d("td",[t._v("11752")]),d("td",[t._v("217.347")]),d("td",[t._v("Africa")]),d("td",[t._v("2.554262e+06")])]),d("tr",[d("th",[t._v("12399")]),d("td",[t._v("South Africa")]),d("td",[t._v("200")]),d("td",[t._v("Psycho!")]),d("td",[t._v("MASN")]),d("td",[t._v("11743")]),d("td",[t._v("197.217")]),d("td",[t._v("Africa")]),d("td",[t._v("2.315919e+06")])])])])]},proxy:!0}],null,!0)},[d("pre",{pre:!0,attrs:{class:"language-text"}},[d("code",{pre:!0,attrs:{class:"language-text"}},[t._v("(music_top200\n  >> mutate(streamed_ms = _.streams * _.duration)\n)")])])]),d("h3",{attrs:{id:"exercise-1-todo"}},[d("a",{attrs:{href:"#exercise-1-todo","aria-hidden":"true"}},[d("span",{staticClass:"icon icon-link"})]),t._v("Exercise 1 TODO:")]),d("p",[t._v("Use the code above, and modify it find the longest streamed ("),d("code",{pre:!0},[t._v("streamed_ms")]),t._v(") song in Canada. Is it the song in the first "),d("code",{pre:!0},[t._v("position")]),t._v("?")]),d("code-cell",{attrs:{status:e.status,onExecute:e.execute,language:"python"},scopedSlots:t._u([{key:"output",fn:function(){return[d("pre",{pre:!0,attrs:{class:"language-text"}},[d("code",{pre:!0,attrs:{class:"language-text"}},[t._v("()")])])]},proxy:!0}],null,!0)},[d("pre",{pre:!0,attrs:{class:"language-text"}},[d("code",{pre:!0,attrs:{class:"language-text"}},[t._v("(\n\n)")])])])]}}])})],1)}),[],!1,null,null,null);"function"==typeof p&&p(v),"function"==typeof f&&f(v);e.default=v.exports}}]);